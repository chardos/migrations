
var W = {}

W.vars = {
	year: 0,
  autoplay: false,
  timerInterval: null
};


W.init = function() {
}

function pullDataAccordingToOptions() {
  var chosenYear = W.vars.year;
  switch(chosenYear) {
    case 0: migrationMap.arc( path1996 ); break;
    case 1: migrationMap.arc( path2001 ); break;
    case 2: migrationMap.arc( path2006 ); break;
    case 3: migrationMap.arc( path2011 ); break;
  }
}

function stopAutoplay() {
  window.clearInterval(W.vars.timerInterval);
  W.vars.timerInterval = null;
  W.vars.autoplay = false;
}

function setupAutoplay() {
  W.vars.autoplay = true;
  incrementDataPullByYearly();
  W.vars.timerInterval = window.setInterval(function() {
    incrementDataPullByYearly();
  }, 2000);
}

function incrementDataPullByYearly() {
  var min = $("#year_slider_ion").data().ionRangeSlider.options.min;
  var max = $("#year_slider_ion").data().ionRangeSlider.options.max;
  var fromToSet = $("#year_slider_ion").data().ionRangeSlider.options.from;
  if(fromToSet >= max) {
    fromToSet = min;
  } else {
    fromToSet++;
  }
  $("#year_slider_ion").data().ionRangeSlider.update({
    from: fromToSet
  });
}

//CONFIG
var arcWidth = [3,2,5,7];
var arcColor = null;
var migrationMap;


$(document).ready(function() {

  migrationMap = new Datamap({
    scope: 'world',
    responsive: true,
    element: document.getElementById('map'),
    projection: 'mercator',
    
    fills: {
      defaultFill: "RGBA(38, 38, 38, 1)"
    },
    
    data: {
      AUS: {
        y1996: 13984720,
        y2001: 14822350,
        y2006: 15419340,
        y2011: 16321840
      },
      NZL: {
        y1996: 312240,
        y2001: 389600,
        y2006: 437890,
        y2011: 543950
      },
      ITA: {
        y1996: 250360,
        y2001: 229850,
        y2006: 218040,
        y2011: 201680
      },
      VNM: {
        y1996: 158740,
        y2001: 163490,
        y2006: 178010,
        y2011: 207620
      },
      GRC: {
        y1996: 138080,
        y2001: 128700,
        y2006: 128980,
        y2011: 121180
      },
      DEU: {
        y1996: 121910,
        y2001: 118340,
        y2006: 124710,
        y2011: 125750
      },
      CHN: {
        y1996: 118640,
        y2001: 153360,
        y2006: 251960,
        y2011: 387420
      },
      PHL: {
        y1996: 104820,
        y2001: 114260,
        y2006: 141890,
        y2011: 193030
      },
      NLD: {
        y1996: 96370,
        y2001: 91900,
        y2006: 91850,
        y2011: 87660
      },
      IND: {
        y1996: 80470,
        y2001: 98070,
        y2006: 169720,
        y2011: 337120
      },
      LBN: {
        y1996: 77670,
        y2001: 79850,
        y2006: 85940,
        y2011: 90030
      },
      POL: {
        y1996: 72420,
        y2001: 65530,
        y2006: 62900,
        y2011: 57900
      },
      ZAF: {
        y1996: 61810,
        y2001: 86820,
        y2006: 119490,
        y2011: 161590
      },
      USA: {
        y1996: 56050,
        y2001: 60780,
        y2006: 74670,
        y2011: 90090
      },
      MLT: {
        y1996: 55980,
        y2001: 51810,
        y2006: 51160,
        y2011: 47960
      },
      LKA: {
        y1996: 53880,
        y2001: 60640,
        y2006: 73820,
        y2011: 99740
      },
      IRL: {
        y1996: 53850,
        y2001: 53650,
        y2006: 56800,
        y2011: 78620
      },
      IDN: {
        y1996: 49020,
        y2001: 53090,
        y2006: 60530,
        y2011: 73060
      },
      FJI: {
        y1996: 40930,
        y2001: 49070,
        y2006: 56350,
        y2011: 65470
      },
      EGY: {
        y1996: 38610,
        y2001: 37420,
        y2006: 39370,
        y2011: 42080
      },
      TUR: {
        y1996: 32100,
        y2001: 34230,
        y2006: 38060,
        y2011: 39980
      },
      SGP: {
        y1996: 31260,
        y2001: 35670,
        y2006: 45810,
        y2011: 55820
      },
      KOR: {
        y1996: 30470,
        y2001: 38980,
        y2006: 55950,
        y2011: 85930
      },
      CAN: {
        y1996: 27970,
        y2001: 31020,
        y2006: 38220,
        y2011: 46230
      },
      HUN: {
        y1996: 27750,
        y2001: 25640,
        y2006: 24040,
        y2011: 22420
      },
      CHL: {
        y1996: 26850,
        y2001: 25920,
        y2006: 27190,
        y2011: 28520
      },
      PNG: {
        y1996: 26120,
        y2001: 25640,
        y2006: 27330,
        y2011: 30650
      },
      JPN: {
        y1996: 25280,
        y2001: 25690,
        y2006: 35390,
        y2011: 41390
      },
      KHM: {
        y1996: 24080,
        y2001: 25100,
        y2006: 28350,
        y2011: 32510
      },
      CYP: {
        y1996: 23310,
        y2001: 22720,
        y2006: 22350,
        y2011: 21150
      },
      AUT: {
        y1996: 22700,
        y2001: 21330,
        y2006: 20950,
        y2011: 19800
      },
      THA: {
        y1996: 19890,
        y2001: 24430,
        y2006: 34060,
        y2011: 52990
      },
      IRN: {
        y1996: 19260,
        y2001: 22250,
        y2006: 28110,
        y2011: 39640
      },
      MUS: {
        y1996: 19020,
        y2001: 18580,
        y2006: 20930,
        y2011: 26780
      },
      PRT: {
        y1996: 18660,
        y2001: 17780,
        y2006: 18280,
        y2011: 18550
      },
      UKR: {
        y1996: 17560,
        y2001: 16660,
        y2006: 17010,
        y2011: 16280
      },
      FRA: {
        y1996: 16500,
        y2001: 18400,
        y2006: 22020,
        y2011: 29770
      },
      ESP: {
        y1996: 14710,
        y2001: 14110,
        y2006: 14430,
        y2011: 15320
      },
      ROU: {
        y1996: 13130,
        y2001: 14380,
        y2006: 16110,
        y2011: 16720
      },
      ARG: {
        y1996: 12140,
        y2001: 12030,
        y2006: 13480,
        y2011: 13800
      },
      MMR: {
        y1996: 11560,
        y2001: 12190,
        y2006: 14320,
        y2011: 24430
      },
      CHE: {
        y1996: 11050,
        y2001: 12250,
        y2006: 13480,
        y2011: 14260
      },
      LAO: {
        y1996: 11020,
        y2001: 10350,
        y2006: 10670,
        y2011: 11300
      },
      URY: {
        y1996: 10980,
        y2001: 10490,
        y2006: 10940,
        y2011: 10540
      },
      DNK: {
        y1996: 9740,
        y2001: 10030,
        y2006: 10610,
        y2011: 10640
      },
      FIN: {
        y1996: 9420,
        y2001: 9360,
        y2006: 9600,
        y2011: 9520
      },
      LVA: {
        y1996: 9180,
        y2001: 6990,
        y2006: 6120,
        y2011: 5470
      },
      ISR: {
        y1996: 7110,
        y2001: 7510,
        y2006: 9440,
        y2011: 10840
      },
      LTU: {
        y1996: 4700,
        y2001: 3630,
        y2006: 3210,
        y2011: 3130
      },
      EST: {
        y1996: 2450,
        y2001: 1860,
        y2006: 1600,
        y2011: 2430
      },
      BRB: {
        y1996: 0,
        y2001: 350,
        y2006: 390,
        y2011: 430
      },
      BHS: {
        y1996: 0,
        y2001: 240,
        y2006: 270,
        y2011: 290
      },
      MEX: {
        y1996: 0,
        y2001: 1320,
        y2006: 2140,
        y2011: 3770
      },
      AFG: {
        y1996: 0,
        y2001: 13860,
        y2006: 21980,
        y2011: 32970
      },
      HND: {
        y1996: 0,
        y2001: 190,
        y2006: 220,
        y2011: 240
      },
      CUB: {
        y1996: 0,
        y2001: 510,
        y2006: 640,
        y2011: 760
      },
      ATG: {
        y1996: 0,
        y2001: 30,
        y2006: 40,
        y2011: 40
      },
      GRD: {
        y1996: 0,
        y2001: 120,
        y2006: 130,
        y2011: 130
      },
      PAN: {
        y1996: 0,
        y2001: 140,
        y2006: 190,
        y2011: 230
      },
      DOM: {
        y1996: 0,
        y2001: 70,
        y2006: 110,
        y2011: 160
      },
      DMA: {
        y1996: 0,
        y2001: 10,
        y2006: 20,
        y2011: 40
      },
      NIC: {
        y1996: 0,
        y2001: 780,
        y2006: 790,
        y2011: 820
      },
      GTM: {
        y1996: 0,
        y2001: 310,
        y2006: 350,
        y2011: 430
      },
      UZB: {
        y1996: 0,
        y2001: 530,
        y2006: 930,
        y2011: 1380
      },
      COL: {
        y1996: 0,
        y2001: 4510,
        y2006: 6230,
        y2011: 13030
      },
      BRA: {
        y1996: 0,
        y2001: 5120,
        y2006: 8500,
        y2011: 17060
      },
      BOL: {
        y1996: 0,
        y2001: 700,
        y2006: 780,
        y2011: 900
      },
      TKM: {
        y1996: 0,
        y2001: 40,
        y2006: 60,
        y2011: 90
      },
      GEO: {
        y1996: 0,
        y2001: 360,
        y2006: 400,
        y2011: 500
      },
      AZE: {
        y1996: 0,
        y2001: 200,
        y2006: 300,
        y2011: 460
      },
      ARM: {
        y1996: 0,
        y2001: 980,
        y2006: 1130,
        y2011: 1220
      },
      TJK: {
        y1996: 0,
        y2001: 50,
        y2006: 60,
        y2011: 110
      },
      KGZ: {
        y1996: 0,
        y2001: 110,
        y2006: 240,
        y2011: 400
      },
      KAZ: {
        y1996: 0,
        y2001: 480,
        y2006: 770,
        y2011: 1310
      },
      VEN: {
        y1996: 0,
        y2001: 1260,
        y2006: 1800,
        y2011: 3870
      },
      SUR: {
        y1996: 0,
        y2001: 80,
        y2006: 110,
        y2011: 120
      },
      SLV: {
        y1996: 0,
        y2001: 10570,
        y2006: 10780,
        y2011: 10990
      },
      CRI: {
        y1996: 0,
        y2001: 350,
        y2006: 390,
        y2011: 450
      },
      BLZ: {
        y1996: 0,
        y2001: 50,
        y2006: 60,
        y2011: 70
      },
      PER: {
        y1996: 0,
        y2001: 5940,
        y2006: 7150,
        y2011: 9840
      },
      ECU: {
        y1996: 0,
        y2001: 1460,
        y2006: 1740,
        y2011: 2000
      },
      PRY: {
        y1996: 0,
        y2001: 360,
        y2006: 420,
        y2011: 450
      },
      GUY: {
        y1996: 0,
        y2001: 530,
        y2006: 570,
        y2011: 610
      },
      TGO: {
        y1996: 0,
        y2001: 20,
        y2006: 40,
        y2011: 320
      },
      AGO: {
        y1996: 0,
        y2001: 410,
        y2006: 470,
        y2011: 530
      },
      SEN: {
        y1996: 0,
        y2001: 240,
        y2006: 260,
        y2011: 380
      },
      SLE: {
        y1996: 0,
        y2001: 370,
        y2006: 1950,
        y2011: 3450
      },
      COM: {
        y1996: 0,
        y2001: 20,
        y2006: 10,
        y2011: 20
      },
      DJI: {
        y1996: 0,
        y2001: 80,
        y2006: 110,
        y2011: 150
      },
      BWA: {
        y1996: 0,
        y2001: 750,
        y2006: 1040,
        y2011: 1120
      },
      BDI: {
        y1996: 0,
        y2001: 30,
        y2006: 830,
        y2011: 1940
      },
      LBR: {
        y1996: 0,
        y2001: 120,
        y2006: 1590,
        y2011: 3010
      },
      MLI: {
        y1996: 0,
        y2001: 30,
        y2006: 50,
        y2011: 60
      },
      GIN: {
        y1996: 0,
        y2001: 30,
        y2006: 290,
        y2011: 720
      },
      GNB: {
        y1996: 0,
        y2001: 20,
        y2006: 10,
        y2011: 20
      },
      NGA: {
        y1996: 0,
        y2001: 1950,
        y2006: 2880,
        y2011: 5130
      },
      STP: {
        y1996: 0,
        y2001: 20,
        y2006: 20,
        y2011: 20
      },
      MRT: {
        y1996: 0,
        y2001: 20,
        y2006: 10,
        y2011: 50
      },
      NER: {
        y1996: 0,
        y2001: 10,
        y2006: 10,
        y2011: 30
      },
      ERI: {
        y1996: 0,
        y2001: 1790,
        y2006: 2400,
        y2011: 3260
      },
      SYC: {
        y1996: 0,
        y2001: 2720,
        y2006: 2940,
        y2011: 2980
      },
      RWA: {
        y1996: 0,
        y2001: 50,
        y2006: 240,
        y2011: 720
      },
      TZA: {
        y1996: 0,
        y2001: 1950,
        y2006: 2760,
        y2011: 3940
      },
      UGA: {
        y1996: 0,
        y2001: 1390,
        y2006: 2050,
        y2011: 3040
      },
      SOM: {
        y1996: 0,
        y2001: 3770,
        y2006: 4620,
        y2011: 6590
      },
      SWZ: {
        y1996: 0,
        y2001: 230,
        y2006: 280,
        y2011: 350
      },
      LSO: {
        y1996: 0,
        y2001: 60,
        y2006: 100,
        y2011: 120
      },
      MDG: {
        y1996: 0,
        y2001: 180,
        y2006: 240,
        y2011: 270
      },
      ETH: {
        y1996: 0,
        y2001: 3820,
        y2006: 6390,
        y2011: 9630
      },
      KEN: {
        y1996: 0,
        y2001: 7640,
        y2006: 11640,
        y2011: 15870
      },
      MOZ: {
        y1996: 0,
        y2001: 640,
        y2006: 790,
        y2011: 890
      },
      MWI: {
        y1996: 0,
        y2001: 540,
        y2006: 820,
        y2011: 1080
      },
      TTO: {
        y1996: 0,
        y2001: 1440,
        y2006: 1580,
        y2011: 1730
      },
      ZWE: {
        y1996: 0,
        y2001: 13210,
        y2006: 23700,
        y2011: 34610
      },
      VCT: {
        y1996: 0,
        y2001: 80,
        y2006: 90,
        y2011: 60
      },
      JAM: {
        y1996: 0,
        y2001: 930,
        y2006: 1040,
        y2011: 1150
      },
      HTI: {
        y1996: 0,
        y2001: 90,
        y2006: 110,
        y2011: 110
      },
      KNA: {
        y1996: 0,
        y2001: 30,
        y2006: 40,
        y2011: 40
      },
      LCA: {
        y1996: 0,
        y2001: 30,
        y2006: 40,
        y2011: 50
      },
      ZMB: {
        y1996: 0,
        y2001: 3510,
        y2006: 4900,
        y2011: 6350
      },
      COD: {
        y1996: 0,
        y2001: 280,
        y2006: 630,
        y2011: 2850
      },
      CIV: {
        y1996: 0,
        y2001: 70,
        y2006: 230,
        y2011: 500
      },
      TCD: {
        y1996: 0,
        y2001: 40,
        y2006: 40,
        y2011: 60
      },
      COG: {
        y1996: 0,
        y2001: 170,
        y2006: 660,
        y2011: 1120
      },
      GMB: {
        y1996: 0,
        y2001: 40,
        y2006: 90,
        y2011: 110
      },
      GHA: {
        y1996: 0,
        y2001: 2250,
        y2006: 3150,
        y2011: 4440
      },
      GNQ: {
        y1996: 0,
        y2001: 0,
        y2006: 10,
        y2011: 10
      },
      GAB: {
        y1996: 0,
        y2001: 20,
        y2006: 30,
        y2011: 30
      },
      BEN: {
        y1996: 0,
        y2001: 20,
        y2006: 30,
        y2011: 90
      },
      CPV: {
        y1996: 0,
        y2001: 30,
        y2006: 30,
        y2011: 30
      },
      CAF: {
        y1996: 0,
        y2001: 0,
        y2006: 10,
        y2011: 20
      },
      BFA: {
        y1996: 0,
        y2001: 20,
        y2006: 20,
        y2011: 40
      },
      CMR: {
        y1996: 0,
        y2001: 70,
        y2006: 140,
        y2011: 320
      },
      ALB: {
        y1996: 0,
        y2001: 1620,
        y2006: 2410,
        y2011: 2950
      },
      SMR: {
        y1996: 0,
        y2001: 0,
        y2006: 10,
        y2011: 10
      },
      HRV: {
        y1996: 0,
        y2001: 58690,
        y2006: 71810,
        y2011: 67580
      },
      BIH: {
        y1996: 0,
        y2001: 28780,
        y2006: 40580,
        y2011: 39440
      },
      WSM: {
        y1996: 0,
        y2001: 13960,
        y2006: 17170,
        y2011: 21820
      },
      VAT: {
        y1996: 0,
        y2001: 0,
        y2006: 0,
        y2011: 0
      },
      AND: {
        y1996: 0,
        y2001: 20,
        y2006: 30,
        y2011: 20
      },
      CZE: {
        y1996: 0,
        y2001: 13070,
        y2006: 13920,
        y2011: 13450
      },
      BLR: {
        y1996: 0,
        y2001: 1360,
        y2006: 1720,
        y2011: 1870
      },
      PLW: {
        y1996: 0,
        y2001: 20,
        y2006: 10,
        y2011: 20
      },
      SVK: {
        y1996: 0,
        y2001: 6430,
        y2006: 5970,
        y2011: 6020
      },
      RUS: {
        y1996: 0,
        y2001: 16710,
        y2006: 18540,
        y2011: 21500
      },
      SVN: {
        y1996: 0,
        y2001: 8440,
        y2006: 8860,
        y2011: 8260
      },
      MDA: {
        y1996: 0,
        y2001: 620,
        y2006: 870,
        y2011: 1040
      },
      SRB: {
        y1996: 0,
        y2001: 52050,
        y2006: 35920,
        y2011: 34850
      },
      MNE: {
        y1996: 0,
        y2001: 5330,
        y2006: 1850,
        y2011: 1850
      },
      TON: {
        y1996: 0,
        y2001: 8350,
        y2006: 8720,
        y2011: 10560
      },
      TUV: {
        y1996: 0,
        y2001: 110,
        y2006: 140,
        y2011: 140
      },
      SWE: {
        y1996: 0,
        y2001: 7300,
        y2006: 8960,
        y2011: 10330
      },
      NOR: {
        y1996: 0,
        y2001: 4230,
        y2006: 4430,
        y2011: 4400
      },
      ISL: {
        y1996: 0,
        y2001: 590,
        y2006: 670,
        y2011: 710
      },
      BEL: {
        y1996: 0,
        y2001: 5380,
        y2006: 5920,
        y2011: 6690
      },
      MCO: {
        y1996: 0,
        y2001: 40,
        y2006: 50,
        y2011: 70
      },
      LUX: {
        y1996: 0,
        y2001: 150,
        y2006: 190,
        y2011: 230
      },
      LIE: {
        y1996: 0,
        y2001: 20,
        y2006: 20,
        y2011: 30
      },
      VUT: {
        y1996: 0,
        y2001: 1040,
        y2006: 1210,
        y2011: 1300
      },
      TLS: {
        y1996: 0,
        y2001: 10420,
        y2006: 10830,
        y2011: 10540
      },
      SLB: {
        y1996: 0,
        y2001: 1440,
        y2006: 1700,
        y2011: 2020
      },
      MAC: {
        y1996: 0,
        y2001: 1960,
        y2006: 2090,
        y2011: 2610
      },
      MYS: {
        y1996: 0,
        y2001: 86400,
        y2006: 105710,
        y2011: 134140
      },
      MHL: {
        y1996: 0,
        y2001: 30,
        y2006: 40,
        y2011: 40
      },
      YEM: {
        y1996: 0,
        y2001: 400,
        y2006: 520,
        y2011: 610
      },
      KIR: {
        y1996: 0,
        y2001: 430,
        y2006: 480,
        y2011: 600
      },
      BRN: {
        y1996: 0,
        y2001: 2150,
        y2006: 2630,
        y2011: 3020
      },
      MNG: {
        y1996: 0,
        y2001: 130,
        y2006: 300,
        y2011: 780
      },
      MDV: {
        y1996: 0,
        y2001: 170,
        y2006: 320,
        y2011: 440
      },
      BTN: {
        y1996: 0,
        y2001: 70,
        y2006: 140,
        y2011: 2680
      },
      NPL: {
        y1996: 0,
        y2001: 2440,
        y2006: 4350,
        y2011: 27810
      },
      BGR: {
        y1996: 0,
        y2001: 3110,
        y2006: 3450,
        y2011: 3620
      },
      PAK: {
        y1996: 0,
        y2001: 12290,
        y2006: 18320,
        y2011: 34150
      },
      BGD: {
        y1996: 0,
        y2001: 9790,
        y2006: 18510,
        y2011: 31620
      },
      TWN: {
        y1996: 0,
        y2001: 24140,
        y2006: 25860,
        y2011: 33450
      },
      PRK: {
        y1996: 0,
        y2001: 410,
        y2006: 430,
        y2011: 230
      },
      ARE: {
        y1996: 0,
        y2001: 1540,
        y2006: 3320,
        y2011: 5570
      },
      NRU: {
        y1996: 0,
        y2001: 480,
        y2006: 580,
        y2011: 620
      },
      PSE: {
        y1996: 0,
        y2001: 3120,
        y2006: 3260,
        y2011: 3020
      },
      BHR: {
        y1996: 0,
        y2001: 760,
        y2006: 1160,
        y2011: 1440
      },
      LBY: {
        y1996: 0,
        y2001: 1460,
        y2006: 1620,
        y2011: 2900
      },
      DZA: {
        y1996: 0,
        y2001: 1240,
        y2006: 1330,
        y2011: 1400
      },
      MAR: {
        y1996: 0,
        y2001: 1360,
        y2006: 1620,
        y2011: 1870
      },
      TUN: {
        y1996: 0,
        y2001: 490,
        y2006: 550,
        y2011: 580
      },
      SDN: {
        y1996: 0,
        y2001: 5090,
        y2006: 20870,
        y2011: 22000
      },
      QAT: {
        y1996: 0,
        y2001: 270,
        y2006: 500,
        y2011: 690
      },
      OMN: {
        y1996: 0,
        y2001: 410,
        y2006: 1040,
        y2011: 1250
      },
      SYR: {
        y1996: 0,
        y2001: 7610,
        y2006: 8440,
        y2011: 9670
      },
      SAU: {
        y1996: 0,
        y2001: 1620,
        y2006: 3550,
        y2011: 12640
      },
      IRQ: {
        y1996: 0,
        y2001: 28480,
        y2006: 39500,
        y2011: 54980
      },
      KWT: {
        y1996: 0,
        y2001: 2630,
        y2006: 3320,
        y2011: 4720
      },
      JOR: {
        y1996: 0,
        y2001: 3620,
        y2006: 4310,
        y2011: 5440
      }
    },

    geographyConfig: {
      highlightColor: 'RGBA(252, 99, 51, 1)',
      highlightBorderColor: '#ffffff',
      popupTemplate: function(geo, data) {
        if (data){
          return '<div class="hoverinfo">' + geo.properties.name + '<br/><br/>' +
            '1996 : ' +  data.y1996 + '<br/>' +
            '2001 : ' +  data.y2001 + '<br/>' +
            '2006 : ' +  data.y2006 + '<br/>' +
            '2011 : ' +  data.y2011 + '<br/>' +
            ' </div>'
        } else {
          return '<div class="hoverinfo">' + geo.properties.name + '</div>'
        }
      },
      highlightBorderWidth: 1
    }

  });

  window.addEventListener('resize', function() {
      migrationMap.resize();
  });

  pullDataAccordingToOptions();

  $('#autoplaybtn').on("click", function(){
    $(this).toggleClass('button-active');
    if($(this).hasClass('button-active')) {
      // play
      setupAutoplay();
    } else {
      // stop
      stopAutoplay();
    }
  });
});
